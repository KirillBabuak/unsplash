{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { DefaultPageSize } from '../constants/global.constants';\nimport { unsplashAPI } from \"../api/unsplash.api\";\nconst initialState = {\n  list: [],\n  search: '',\n  currentPage: 1,\n  currentSize: DefaultPageSize,\n  allCount: 0,\n  error: null,\n  loading: false\n};\nexport const fetchPhotos = createAsyncThunk('photos/fetchPhotos', async (anyData, {\n  rejectWithValue,\n  getState\n}) => {\n  try {\n    const {\n      photos\n    } = getState();\n    const {\n      search,\n      currentSize,\n      currentPage\n    } = photos;\n    const params = {\n      page: currentPage,\n      per_page: currentSize,\n      client_id: process.env.REACT_APP_UNSPLASH_ACCESS_KEY || '',\n      query: search\n    };\n    return await unsplashAPI.fetchPhotos(params);\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nexport const setSearch = createAsyncThunk('photos/setSearch', async (search, {\n  rejectWithValue,\n  dispatch,\n  getState\n}) => {\n  try {\n    const {\n      photos\n    } = getState();\n    const {\n      search: currentSearchValue\n    } = photos;\n\n    if (currentSearchValue === search) {\n      return;\n    }\n\n    dispatch(setSearchAC(search));\n    dispatch(fetchPhotos());\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nexport const changePhotoLike = createAsyncThunk('photos/changePhotoLike', async (payload, {\n  rejectWithValue,\n  dispatch\n}) => {\n  try {\n    const clientId = process.env.REACT_APP_UNSPLASH_ACCESS_KEY || '';\n    await unsplashAPI.changeLikePhoto(payload, clientId);\n    return payload;\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nconst photosSlice = createSlice({\n  name: 'photos',\n  initialState,\n  reducers: {\n    setPhotos(state, action) {\n      state.list = action.payload.list;\n    },\n\n    setSearchAC(state, action) {\n      state.search = action.payload;\n    },\n\n    setPageAC(state) {\n      state.currentPage = +1;\n    }\n\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchPhotos.fulfilled, (state, action) => {\n      const {\n        total,\n        results\n      } = action.payload;\n      state.list = state.currentPage === 1 ? results : [...state.list, ...results];\n      state.allCount = total;\n      state.loading = false;\n    });\n    builder.addCase(fetchPhotos.rejected, (state, action) => {\n      state.error = action.payload;\n      state.loading = false;\n    });\n    builder.addCase(fetchPhotos.pending, (state, action) => {\n      state.loading = true;\n    });\n    builder.addCase(changePhotoLike.fulfilled, (state, action) => {\n      const {\n        id,\n        isLiked\n      } = action.payload;\n      state.list.map(photo => photo.id === id ? { ...photo,\n        liked_by_user: isLiked,\n        likes: isLiked ? photo.likes + 1 : photo.likes - 1\n      } : photo);\n      state.loading = false;\n    });\n    builder.addCase(changePhotoLike.rejected, (state, action) => {\n      state.error = action.payload;\n      state.loading = false;\n    });\n    builder.addCase(changePhotoLike.pending, (state, action) => {\n      state.loading = true;\n    });\n  }\n});\nexport const photosReducer = photosSlice.reducer;\nexport const {\n  setSearchAC,\n  setPageAC\n} = photosSlice.actions;","map":{"version":3,"sources":["/Users/softarex-093/Documents/unsplash/src/reducers/photos.reducer.ts"],"names":["createAsyncThunk","createSlice","DefaultPageSize","unsplashAPI","initialState","list","search","currentPage","currentSize","allCount","error","loading","fetchPhotos","anyData","rejectWithValue","getState","photos","params","page","per_page","client_id","process","env","REACT_APP_UNSPLASH_ACCESS_KEY","query","message","setSearch","dispatch","currentSearchValue","setSearchAC","changePhotoLike","payload","clientId","changeLikePhoto","photosSlice","name","reducers","setPhotos","state","action","setPageAC","extraReducers","builder","addCase","fulfilled","total","results","rejected","pending","id","isLiked","map","photo","liked_by_user","likes","photosReducer","reducer","actions"],"mappings":"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","sourcesContent":["import {createAsyncThunk, createSlice, PayloadAction} from '@reduxjs/toolkit';\nimport {DefaultPageSize} from '../constants/global.constants';\nimport {\n    IChangePhotoLikeRequest,\n    IFetchPhotosQuery,\n    IGetPhotosResponse,\n    IPhotoInfo\n} from \"../interfaces/unsplash.interface\";\nimport {AppStateType} from './store';\nimport {unsplashAPI} from \"../api/unsplash.api\";\n\nexport type InitialState = {\n    list: IPhotoInfo[],\n    search: string,\n    currentPage: number,\n    currentSize: number,\n    allCount: number;\n    error: string | null\n    loading: boolean\n}\n\nconst initialState: InitialState = {\n    list: [],\n    search: '',\n    currentPage: 1,\n    currentSize: DefaultPageSize,\n    allCount: 0,\n    error: null,\n    loading: false\n};\n\nexport const fetchPhotos = createAsyncThunk(\n    'photos/fetchPhotos',\n    async (anyData, {rejectWithValue, getState}): Promise<IGetPhotosResponse | Error> => {\n        try {\n            const {photos} = getState() as AppStateType;\n            const {search, currentSize, currentPage} = photos;\n\n            const params: IFetchPhotosQuery = {\n                page: currentPage,\n                per_page: currentSize,\n                client_id: process.env.REACT_APP_UNSPLASH_ACCESS_KEY || '',\n                query: search,\n            }\n\n            return await unsplashAPI.fetchPhotos(params)\n        } catch (error) {\n            return rejectWithValue(error.message)\n        }\n    }\n)\n\nexport const setSearch = createAsyncThunk(\n    'photos/setSearch',\n    async (search: string, {rejectWithValue, dispatch, getState}) => {\n        try {\n            const {photos} = getState() as AppStateType;\n            const {search: currentSearchValue} = photos;\n\n            if (currentSearchValue === search) {\n                return;\n            }\n\n            dispatch(setSearchAC(search))\n            dispatch(fetchPhotos())\n        } catch (error) {\n            return rejectWithValue(error)\n        }\n    }\n)\n\nexport const changePhotoLike = createAsyncThunk(\n    'photos/changePhotoLike',\n    async (payload: IChangePhotoLikeRequest, {rejectWithValue, dispatch}) => {\n        try {\n            const clientId = process.env.REACT_APP_UNSPLASH_ACCESS_KEY || ''\n            await unsplashAPI.changeLikePhoto(payload, clientId)\n            return payload;\n        } catch (error) {\n            return rejectWithValue(error)\n        }\n    }\n)\n\nconst photosSlice = createSlice({\n    name: 'photos',\n    initialState,\n    reducers: {\n        setPhotos(state: InitialState, action: PayloadAction<{ list: IPhotoInfo[] }>) {\n            state.list = action.payload.list;\n        },\n        setSearchAC(state: InitialState, action: PayloadAction<string>) {\n            state.search = action.payload;\n        },\n        setPageAC(state: InitialState) {\n            state.currentPage = +1;\n        },\n    },\n    extraReducers: builder => {\n        builder.addCase(fetchPhotos.fulfilled, (state, action) => {\n            const {total, results} = action.payload as IGetPhotosResponse\n\n            state.list = state.currentPage === 1 ? results : [...state.list, ...results];\n            state.allCount = total;\n            state.loading = false;\n        })\n        builder.addCase(fetchPhotos.rejected, (state, action) => {\n            state.error = action.payload as string;\n            state.loading = false;\n        })\n        builder.addCase(fetchPhotos.pending, (state, action) => {\n            state.loading = true;\n        })\n        builder.addCase(changePhotoLike.fulfilled, (state, action) => {\n            const {id, isLiked} = action.payload;\n\n            state.list.map(photo => photo.id === id ? {\n                ...photo,\n                liked_by_user: isLiked,\n                likes: isLiked ? photo.likes + 1 : photo.likes - 1\n            } : photo);\n            state.loading = false;\n        })\n        builder.addCase(changePhotoLike.rejected, (state, action) => {\n            state.error = action.payload as string;\n            state.loading = false;\n        })\n        builder.addCase(changePhotoLike.pending, (state, action) => {\n            state.loading = true;\n        })\n    }\n});\n\nexport const photosReducer = photosSlice.reducer;\nexport const {setSearchAC, setPageAC} = photosSlice.actions;"]},"metadata":{},"sourceType":"module"}