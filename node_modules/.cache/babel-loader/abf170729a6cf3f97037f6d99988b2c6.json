{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport { DefaultPageSize } from '../constants/global.constants';\nimport { unsplashAPI } from \"../api/unsplash.api\";\nconst initialState = {\n  list: [],\n  search: '',\n  currentPage: 1,\n  currentSize: DefaultPageSize,\n  allCount: 0,\n  error: null,\n  loading: false\n};\nexport const fetchPhotos = createAsyncThunk('photos/fetchPhotos', async (anyData, {\n  rejectWithValue,\n  getState\n}) => {\n  try {\n    const {\n      photos\n    } = getState();\n    const {\n      search,\n      currentSize,\n      currentPage\n    } = photos;\n    const params = {\n      page: currentPage,\n      per_page: currentSize,\n      client_id: process.env.REACT_APP_UNSPLASH_ACCESS_KEY || '',\n      query: search\n    };\n    return unsplashAPI.fetchPhotos(params);\n  } catch (error) {\n    return rejectWithValue(error.message);\n  }\n});\nexport const setSearch = createAsyncThunk('photos/setSearch', async (search, {\n  rejectWithValue,\n  dispatch,\n  getState\n}) => {\n  try {\n    const {\n      photos\n    } = getState();\n    const {\n      search: currentSearchValue\n    } = photos;\n\n    if (currentSearchValue === search) {\n      return;\n    }\n\n    dispatch(setSearchAC(search));\n    dispatch(fetchPhotos());\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nexport const changePhotoLike = createAsyncThunk('photos/changePhotoLike', async (payload, {\n  rejectWithValue\n}) => {\n  try {\n    return unsplashAPI.changeLikePhoto(payload);\n  } catch (error) {\n    return rejectWithValue(error);\n  }\n});\nconst photosSlice = createSlice({\n  name: 'photos',\n  initialState,\n  reducers: {\n    setPhotos(state, action) {\n      state.list = action.payload.list;\n    },\n\n    setSearchAC(state, action) {\n      state.search = action.payload;\n    },\n\n    setPageAC(state) {\n      state.currentPage = +1;\n    },\n\n    clearPhotosAC(state) {\n      state = initialState;\n    }\n\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchPhotos.fulfilled, (state, action) => {\n      const {\n        total,\n        results\n      } = action.payload;\n      state.list = state.currentPage === 1 ? results : [...state.list, ...results];\n      state.allCount = total;\n      state.loading = false;\n    });\n    builder.addCase(fetchPhotos.rejected, (state, action) => {\n      state.error = action.payload;\n      state.loading = false;\n    });\n    builder.addCase(fetchPhotos.pending, (state, action) => {\n      state.loading = true;\n    });\n    builder.addCase(changePhotoLike.fulfilled, (state, action) => {\n      const updatedPhoto = action.payload;\n      state.list.map(photo => photo.id === updatedPhoto.id ? updatedPhoto : photo);\n      state.loading = false;\n    });\n    builder.addCase(changePhotoLike.rejected, (state, action) => {\n      state.error = action.payload;\n      state.loading = false;\n    });\n    builder.addCase(changePhotoLike.pending, (state, action) => {\n      state.loading = true;\n    });\n  }\n});\nexport const photosReducer = photosSlice.reducer;\nexport const {\n  setSearchAC,\n  setPageAC,\n  clearPhotosAC\n} = photosSlice.actions;","map":{"version":3,"sources":["/Users/softarex-093/Documents/unsplash/src/reducers/photos.reducer.ts"],"names":["createAsyncThunk","createSlice","DefaultPageSize","unsplashAPI","initialState","list","search","currentPage","currentSize","allCount","error","loading","fetchPhotos","anyData","rejectWithValue","getState","photos","params","page","per_page","client_id","process","env","REACT_APP_UNSPLASH_ACCESS_KEY","query","message","setSearch","dispatch","currentSearchValue","setSearchAC","changePhotoLike","payload","changeLikePhoto","photosSlice","name","reducers","setPhotos","state","action","setPageAC","clearPhotosAC","extraReducers","builder","addCase","fulfilled","total","results","rejected","pending","updatedPhoto","map","photo","id","photosReducer","reducer","actions"],"mappings":"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","sourcesContent":["import {createAsyncThunk, createSlice, PayloadAction} from '@reduxjs/toolkit';\nimport {DefaultPageSize} from '../constants/global.constants';\nimport {\n    IChangePhotoLikeRequest,\n    IFetchPhotosQuery,\n    IGetPhotosResponse,\n    IPhotoInfo\n} from \"../interfaces/unsplash.interface\";\nimport {AppStateType} from './store';\nimport {unsplashAPI} from \"../api/unsplash.api\";\n\nexport type InitialState = {\n    list: IPhotoInfo[],\n    search: string,\n    currentPage: number,\n    currentSize: number,\n    allCount: number;\n    error: string | null\n    loading: boolean\n}\n\nconst initialState: InitialState = {\n    list: [],\n    search: '',\n    currentPage: 1,\n    currentSize: DefaultPageSize,\n    allCount: 0,\n    error: null,\n    loading: false\n};\n\nexport const fetchPhotos = createAsyncThunk(\n    'photos/fetchPhotos',\n    async (anyData, {rejectWithValue, getState}): Promise<IGetPhotosResponse | Error> => {\n        try {\n            const {photos} = getState() as AppStateType;\n            const {search, currentSize, currentPage} = photos;\n\n            const params: IFetchPhotosQuery = {\n                page: currentPage,\n                per_page: currentSize,\n                client_id: process.env.REACT_APP_UNSPLASH_ACCESS_KEY || '',\n                query: search,\n            }\n\n            return unsplashAPI.fetchPhotos(params)\n        } catch (error) {\n            return rejectWithValue(error.message)\n        }\n    }\n)\n\nexport const setSearch = createAsyncThunk(\n    'photos/setSearch',\n    async (search: string, {rejectWithValue, dispatch, getState}) => {\n        try {\n            const {photos} = getState() as AppStateType;\n            const {search: currentSearchValue} = photos;\n\n            if (currentSearchValue === search) {\n                return;\n            }\n\n            dispatch(setSearchAC(search))\n            dispatch(fetchPhotos())\n        } catch (error) {\n            return rejectWithValue(error)\n        }\n    }\n)\n\nexport const changePhotoLike = createAsyncThunk(\n    'photos/changePhotoLike',\n    async (payload: IChangePhotoLikeRequest, {rejectWithValue}) => {\n        try {\n            return unsplashAPI.changeLikePhoto(payload)\n        } catch (error) {\n            return rejectWithValue(error)\n        }\n    }\n)\n\nconst photosSlice = createSlice({\n    name: 'photos',\n    initialState,\n    reducers: {\n        setPhotos(state: InitialState, action: PayloadAction<{ list: IPhotoInfo[] }>) {\n            state.list = action.payload.list;\n        },\n        setSearchAC(state: InitialState, action: PayloadAction<string>) {\n            state.search = action.payload;\n        },\n        setPageAC(state: InitialState) {\n            state.currentPage = +1;\n        },\n        clearPhotosAC(state: InitialState) {\n            state = initialState;\n        },\n    },\n    extraReducers: builder => {\n        builder.addCase(fetchPhotos.fulfilled, (state, action) => {\n            const {total, results} = action.payload as IGetPhotosResponse\n\n            state.list = state.currentPage === 1 ? results : [...state.list, ...results];\n            state.allCount = total;\n            state.loading = false;\n        })\n        builder.addCase(fetchPhotos.rejected, (state, action) => {\n            state.error = action.payload as string;\n            state.loading = false;\n        })\n        builder.addCase(fetchPhotos.pending, (state, action) => {\n            state.loading = true;\n        })\n        builder.addCase(changePhotoLike.fulfilled, (state, action) => {\n            const updatedPhoto = action.payload as IPhotoInfo;\n\n            state.list.map(photo => photo.id === updatedPhoto.id ? updatedPhoto : photo);\n            state.loading = false;\n        })\n        builder.addCase(changePhotoLike.rejected, (state, action) => {\n            state.error = action.payload as string;\n            state.loading = false;\n        })\n        builder.addCase(changePhotoLike.pending, (state, action) => {\n            state.loading = true;\n        })\n    }\n});\n\nexport const photosReducer = photosSlice.reducer;\nexport const {setSearchAC, setPageAC, clearPhotosAC} = photosSlice.actions;"]},"metadata":{},"sourceType":"module"}